<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="../css/pmag.css" type="text/css" />
</head>
<body>
<div id="header_wrap">
   <h1><a href="https://www.facebook.com/groups/programmerMagazine">程式人雜誌</a> <sub> --  <a href="https://dl.dropbox.com/u/101584453/pmag/201312/htm/home.html">2014 年 1 月號</a> (開放公益出版品)</sub></h1>
</div>
<div id="content">
<div id="TOC">
<ul>
<li><a href="#金融短訊比特幣-bit-coin-的運作原理">金融短訊：比特幣 (Bit Coin) 的運作原理</a></li>
</ul>
</div>
<h2 id="金融短訊比特幣-bit-coin-的運作原理"><a href="#金融短訊比特幣-bit-coin-的運作原理">金融短訊：比特幣 (Bit Coin) 的運作原理</a></h2>
<h3 id="前言"><a href="#前言">前言</a></h3>
<p>最近比特幣漲到 900 美元，引起了很多注目，可惜我還不知道比特幣到底是甚麼碗糕？所以、想說趁編雜誌的機會 瞭解一下，比特幣到底是怎麼運作的。</p>
<p>2008 年日本的「中本聰」（Satoshi Nakamoto，化名）提出了一種數位貨幣，有興趣者請參考「中本聰」的原始論文：</p>
<ul>
<li>Bitcoin: A Peer-to-Peer Electronic Cash System -- <a href="http://bitcoin.org/bitcoin.pdf">http://bitcoin.org/bitcoin.pdf</a></li>
</ul>
<p>隨後，他以開放、對等、共識、直接參與的理念為基準， 結合開源軟體和密碼學中塊密碼的工作模式，在P2P對等網路和分布式資料庫的平台上，開發出比特幣發行、 交易和帳戶管理的作業系統。其系統讓遍布整個對等網路使用者端的各節點，按照其種子檔案達成網路協定， 從而確保在貨幣發行、管理、流通等環節中公平、安全、可靠。並承諾比特幣將成為類似電子郵件的「電子現金」。實作在不需要審批、人人都有權發行的前提下，避免通貨膨脹，並無法偽造；支付完成之後，使用者就失去對該比特幣的所有權。2009年1月3日50個比特幣問世。</p>
<p>與傳統貨幣不同，比特幣執行機制不依賴中央銀行、政府、企業的支援或者信用擔保，而是依賴對等網路中種子檔案達成的網路協定，去中心化、自我完善的貨幣體制，理論上確保了任何人、機構、或政府都不可能操控比特幣的貨幣總量，或者製造通貨膨脹。它的貨幣總量按照設計預定的速率逐步增加，增加速度逐步放緩，並最終在2140年達到2100萬個的極限。</p>
<p>有多種途徑使用比特幣，透過電子貨幣交易所、服務商和個人等渠道，就能兌換為當地的現金或金幣；也可以直接使用它購買物品和服務。隨著接受比特幣支付的個人、組織、商家和企業的迅速增長，其匯率在四年內上漲了數千倍。 截止到2013年3月30日，全部發行比特幣按市價換算為美元後，總值突破為10億美元。雖然比特幣是目前使用最為廣泛的一種電子貨幣，但是除部分國家對虛擬貨幣有明文規定外，還沒有任何國家對比特幣的發行作出法律的規範和保障。</p>
<p>2009年1月3日，中本聰開創了比特幣P2P開源使用者群節點和雜湊函式系統，從此，其對等網路和它的第一個區塊鏈開始執行， 他發行了有史以來的第一組50個比特幣。</p>
<p>一年後，在比特幣論壇上，使用者群的自發交易中，產生了第一個比特幣公允匯率。該交易是一名使用者發送一萬個比特幣， 購買了一個披薩餅。目前，比特幣最為主要的參考匯率是 MT.GOX 交易所內比特幣與美元的成交匯率。</p>
<p>2013 年 11 月 18 日，在東京的 MT.GOX 市場交易的比特幣對美元匯率飆升至一對九百美元。</p>
<p>如果一塊披薩以 10 元美金計算的話，比特幣從 2010 年到 2013 年間，已經從萬分之十美元，漲到了九百美元，總共漲了 九十萬倍，這真是超級誇張的一種漲法啊！</p>
<h3 id="比特幣的運作方法"><a href="#比特幣的運作方法">比特幣的運作方法</a></h3>
<p>比特幣是類似電子郵件的電子現金，交易雙方需要類似電子信箱的「比特幣錢包」和類似電郵位址的「比特幣位址」。和收發電子郵件一樣，匯款方透過電腦或智慧型手機，按收款方位址將比特幣直接付給對方。下列表格，列出了免費下載比特幣錢包和位址的部分網站。</p>
<table>
<thead>
<tr class="header">
<th align="left">使用者端名稱</th>
<th align="left">網址</th>
<th align="left">許可協定</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Multibit（雲端資料區塊功能）</td>
<td align="left">http://multibit.org/</td>
<td align="left">MIT</td>
</tr>
<tr class="even">
<td align="left">Bitcoin-Qt（中本聰使用者端）</td>
<td align="left">http://sourceforge.net/projects/bitcoin/</td>
<td align="left">MIT</td>
</tr>
<tr class="odd">
<td align="left">My Wallet（線上錢包，獨立式）</td>
<td align="left">https://blockchain.info/wallet</td>
<td align="left">專有軟體</td>
</tr>
<tr class="even">
<td align="left">Coinbase（線上錢包，混合式）</td>
<td align="left">http://coinbase.com</td>
<td align="left">專有軟體</td>
</tr>
<tr class="odd">
<td align="left">Electrum</td>
<td align="left">http://electrum.ecdsa.org/</td>
<td align="left">GPL</td>
</tr>
<tr class="even">
<td align="left">Armory（具有離線儲存功能）</td>
<td align="left">http://bitcoinarmory.com</td>
<td align="left">AGPL</td>
</tr>
</tbody>
</table>
<p>舉例而言，「1DwunA9otZZQyhkVvkLJ8DV1tuSwMF7r3v」就是一個比特幣位址，比特幣位址是由 27 到 34 個之間的英文或數字所構成的，第一個字元只能是 1 或 3。(這個位址類似 RSA 當中的公鑰)</p>
<p>比特幣位址和私鑰是成對出現的，他們的關聯就像銀行卡號和密碼。比特幣位址就像銀行卡號一樣用來記錄你在該位址上存有多少比特幣。你可以隨意的生成比特幣位址來存放比特幣。每個比特幣位址在生成時，都會有一個相對應的該位址的私鑰被生成出來。這個私鑰可以證明你對該位址上的比特幣具有所有權。我們可以簡單的把比特幣位址理解成為銀行卡號，該位址的私鑰理解成為所對應銀行卡號的密碼。只有你在知道銀行密碼的情況下才能使用銀行卡號上的錢。所以，在使用比特幣錢包時請保存好你的位址和私鑰。</p>
<h3 id="中本聰的論文"><a href="#中本聰的論文">中本聰的論文</a></h3>
<p>如果您瞭解 RSA 這樣的非對稱式金鑰加密系統，要瞭解比特幣的技術應該就不太難了。</p>
<p>透過公開金鑰的方式，我們可以設計出如下圖的加解密貨幣系統，來紀錄每一筆交易，但是這樣的系統有個弱點，就是沒辦法 防止同一塊錢 (coin) 被重複使用。</p>
<div class="figure">
<img src="../img/BitcoinModel1.jpg" alt="圖、傳統的數位貨幣系統架構圖" /><p class="caption">圖、傳統的數位貨幣系統架構圖</p>
</div>
<p>如果要避免重複使用的問題，那麼就必須要加入「造幣廠」(mint) 中央控管的方式，以下是「中本聰」在該論文談到的關鍵文句。</p>
<blockquote>
<p>The problem of course is the payee can't verify that one of the owners did not double-spend the coin. A common solution is to introduce a trusted central authority, or mint, that checks every transaction for double spending. After each transaction, the coin must be returned to the mint to issue a new coin, and only coins issued directly from the mint are trusted not to be double-spent. The problem with this solution is that the fate of the entire money system depends on the company running the mint, with every transaction having to go through them, just like a bank</p>
</blockquote>
<p>所以、我們需要在「沒有造幣廠中央控管」的情況下，設計出一種機制，能夠讓收款人 (payee) 確定該「數位錢幣」的前一任收款人 (previous owner) 沒有重覆花用該錢幣。</p>
<blockquote>
<p>We need a way for the payee to know that the previous owners did not sign any earlier transactions. For our purposes, the earliest transaction is the one that counts, so we don't care about later attempts to double-spend. The only way to confirm the absence of a transaction is to be aware of all transactions. In the mint based model, the mint was aware of all transactions and decided which arrived first. To accomplish this without a trusted party, transactions must be publicly announced, and we need a system for participants to agree on a single history of the order in which they were received. The payee needs proof that at the time of each transaction, the majority of nodes agreed it was the first received.</p>
</blockquote>
<p>為了設計出這樣的機制，中本聰提出了一個採用「時間簽章伺服器」的辦法，該錢幣的每一手用戶都要對前一手的訊息 (包含簽章) 再進行簽章，如下圖所示：</p>
<blockquote>
<p>The solution we propose begins with a timestamp server. A timestamp server works by taking a hash of a block of items to be timestamped and widely publishing the hash, such as in a newspaper or Usenet post. The timestamp proves that the data must have existed at the time, obviously, in order to get into the hash. Each timestamp includes the previous timestamp in its hash, forming a chain, with each additional timestamp reinforcing the ones before it.</p>
</blockquote>
<div class="figure">
<img src="../img/bitcoinTimestamp.jpg" alt="圖、對交易進行時間簽章的機制" /><p class="caption">圖、對交易進行時間簽章的機制</p>
</div>
<h3 id="雜湊現金系統"><a href="#雜湊現金系統">雜湊現金系統</a></h3>
<p>為了實現這種點對點 (Peer-to-Peer) 的貨幣系統，中本聰採用了 Adam Back 在以下論文中所創造出的一種「雜湊現金」 系統，這種系統才是虛擬貨幣的主角，而「中本聰」的主要貢獻是將 P2P 的機制引入這種「雜湊現金」系統當中，並創造出對應的程式。</p>
<ul>
<li><a href="http://www.hashcash.org/papers/hashcash.pdf">Hashcash - A Denial of Service Counter-Measure (PDF)</a>, 1st August 2002</li>
</ul>
<p>上述文章並非第一篇，而是 Adam Back 在 1997 年提出 hashcash stamp 五年後的一個總結版本，後來 Adam Back 為此成立了以下網站：</p>
<ul>
<li><a href="http://www.hashcash.org/">http://www.hashcash.org/</a></li>
</ul>
<p>(筆者註：學術論文往往都是這樣，看一篇論文時，最麻煩的是一層一層往上追，追出與該技術相關的重要論文，以便串出整個故事的脈絡)</p>
<h3 id="成本函數-cost-functions"><a href="#成本函數-cost-functions">成本函數 (Cost-Functions)</a></h3>
<p>為了建構出一種無法否認的「數位現金」系統，必須仰賴一類稱為「成本函數」 (Cost-Functions) 的不可逆函數，這種函數「很容易驗證」(efﬁciently veriﬁable)，但是卻很難破解 (parameterisably expensive to compute)。</p>
<blockquote>
<p>A cost-function should be efﬁciently veriﬁable, but parameterisably expensive to compute. We use the following notation to deﬁne a cost-function.</p>
</blockquote>
<p>成本函數並非只被用在現金系統上，也可以用在對付「垃圾郵件」上，例如以下文章中就記載可用像「因數分解」這樣的問題來考驗「寄信者」 讓他們不容易到處發垃圾信，因為收信端只接受那些「通過因數分解」問題的信件，於是發垃圾郵件者就必須耗費大量的 CPU 時間去發信給這些採用 Cost-Functions 認證的人，否則信件就不會被接受。</p>
<ul>
<li><a href="http://www.ibm.com/developerworks/cn/linux/l-hashcash.html">可爱的 Python: 用 hashcash 打击垃圾邮件-想发送垃圾邮件，就要付出代价</a>, David Mertz, Ph.D. (mertz@gnosis.cx), 开发人员, Gnosis Software, Inc.</li>
</ul>
<blockquote>
<p>對交互式質詢來說，因數分解足以勝任。比如，我有一個在線資源，希望您能像征性地為其付出代價。 我可以向您發送一個消息，說“只要您能因數分解這個數，我將讓您得到這個資源”。沒有誠意的人將無法得到我的資源，只有那些能夠證明自己有足夠的興趣、付出一些 CPU 周期來回答這個質詢的人才能得到這個資源。</p>
</blockquote>
<p>但是質數問題並不是最好用的，目前最常使用的 Cost-Function 是 SHA (Secure Hash Algorithm)，其運作方法如下</p>
<blockquote>
<p>hashcash 提出質詢的方式是，當通過安全散列算法（Secure Hash Algorithm）進行散列時，要求 “minters” 生成一個字符串（戳記，stamps），在它們的散列中有很多前導零。所找到的前導零的數目就是特定戳記的比特值。 給定 SHA-1 的一致性與加密強度，找出給定比特值的 hashcash 戳記的惟一已知途徑是平均 2^b 次運行 SHA-1。</p>
<p>然而，要確認一個戳記，只需要進行一次 SHA-1 計算即可。對於電子郵件中的應用來說，當前推薦使用的是 20-比特值： 為了找到一個合法的戳記，發送者需要進行大約一百萬次嘗試，在最新的 CPU 和經過編譯的應用程序上，這將需要不到一秒的時間。在相對舊一些的機器上它也只需要幾秒鐘的時間。</p>
</blockquote>
<p>由於 SHA 可以很容易的設定 b 的大小，從而可以很容易的控制該 Cost-Function 的難度，於是我門就可以指定希望耗用的 CPU 時間， 而那些願意耗用這些 CPU 時間的人，就可以透過 CPU 時間換取這種「數位現金」。</p>
<p>必須注意的是，比特幣採用的算法是 SHA-2，而非上述防止垃圾郵件文章中所使用的 SHA-1 演算法。</p>
<h3 id="比特幣的關鍵原理"><a href="#比特幣的關鍵原理">比特幣的關鍵原理</a></h3>
<p>有了像 SHA-1, SHA-2 這類的 Cost-Function 之後，我們就可以創建出一種仰賴於 SHA 中位元數 b 的現金系統，以下是「中本聰」論文中的 圖片與說明：</p>
<div class="figure">
<img src="../img/bitcoinBlockChain.jpg" alt="圖、越往後、難度越高的現金產生方式 Block-Chain" /><p class="caption">圖、越往後、難度越高的現金產生方式 Block-Chain</p>
</div>
<blockquote>
<p>The proof-of-work involves scanning for a value that when hashed, such as with SHA-256, the hash begins with a number of zero bits. The average work required is exponential in the number of zero bits required and can be verified by executing a single hash.</p>
<p>For our timestamp network, we implement the proof-of-work by incrementing a nonce in the block until a value is found that gives the block's hash the required zero bits. Once the CPU effort has been expended to make it satisfy the proof-of-work, the block cannot be changed without redoing the work. As later blocks are chained after it, the work to change the block would include redoing all the blocks after it.</p>
<p>The proof-of-work also solves the problem of determining representation in majority decision making. If the majority were based on one-IP-address-one-vote, it could be subverted by anyone able to allocate many IPs. Proof-of-work is essentially one-CPU-one-vote. The majority decision is represented by the longest chain, which has the greatest proof-of-work effort invested in it. If a majority of CPU power is controlled by honest nodes, the honest chain will grow the fastest and outpace any competing chains. To modify a past block, an attacker would have to redo the proof-of-work of the block and all blocks after it and then catch up with and surpass the work of the honest nodes. We will show later that the probability of a slower attacker catching up diminishes exponentially as subsequent blocks are added.</p>
</blockquote>
<p>由於「比特幣」一開始時，全世界都沒有「這種現金」存在，因此 b=0 的區域都是可以很容易算出來的，等到這個世界的比特幣越來越多之後， SHA-2 的 b 就會越來越長，於是想要找出這種 SHA-2 的解答就會越來越難，這也是比特幣之所以越來越難挖的原因了。</p>
<h3 id="待續"><a href="#待續">待續</a></h3>
<p>研讀至此，我大概已經理解了比特幣的運作原理，剩下的就是整個「貨幣系統」的建構細節考量了，有機會筆者會再找時間研讀「中本聰」的論文並再度與大家分享！</p>
<h3 id="參考文獻"><a href="#參考文獻">參考文獻</a></h3>
<ul>
<li>維基百科：<a href="http://zh.wikipedia.org/wiki/%E6%AF%94%E7%89%B9%E5%B8%81">比特幣</a></li>
<li>Bitcoin: A Peer-to-Peer Electronic Cash System -- <a href="http://bitcoin.org/bitcoin.pdf">http://bitcoin.org/bitcoin.pdf</a></li>
<li><a href="http://www.hashcash.org/papers/hashcash.pdf">Hashcash - A Denial of Service Counter-Measure (PDF)</a>, 1st August 2002</li>
<li>http://www.hashcash.org/</li>
<li><a href="http://www.libertytimes.com.tw/2013/new/nov/20/today-int1.htm">自由時報：美正視虛擬貨幣 比特幣爭合法</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/linux/l-hashcash.html">可爱的 Python: 用 hashcash 打击垃圾邮件-想发送垃圾邮件，就要付出代价</a>, David Mertz, Ph.D. (mertz@gnosis.cx), 开发人员, Gnosis Software, Inc.</li>
</ul>
<p>【本文由陳鍾誠取材並修改自 <a href="http://zh.wikipedia.org/">維基百科</a>，採用創作共用的 <a href="http://creativecommons.org/licenses/by-sa/3.0/tw/">姓名標示、相同方式分享</a> 授權】</p>
</div>
<div id="footer">
<a href="https://www.facebook.com/groups/programmerMagazine/">程式人雜誌</a> ，採用 <a href="http://creativecommons.org/licenses/by-sa/3.0/tw/ ">創作共用：姓名標示、相同方式分享</a> 授權，歡迎加入 <a href="https://www.facebook.com/groups/programmerMagazine/">雜誌社團</a>
</div>
</body>
</html>
